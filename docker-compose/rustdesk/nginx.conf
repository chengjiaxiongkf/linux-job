# RustDesk Nginx配置
# 主要用于端口转发和负载均衡，而不是Web界面

events {
    worker_connections 1024;
}

http {
    # 上游服务器配置
    upstream rustdesk_server {
        server rustdesk-server:21115;
    }

    # 简单的HTTP服务器，用于健康检查和基本信息
    server {
        listen 80;
        server_name _;

        # 根路径 - 返回基本信息
        location / {
            default_type text/html;
            return 200 '
<html>
<head><title>RustDesk Server</title></head>
<body>
<h1>RustDesk Server is Running</h1>
<p>Server Key: jUToQvft556ICjr4cTmh3Res3LkhkA06ofcI+3LmUIU=</p>
<p>ID Server: 192.168.1.3:21116</p>
<p>Relay Server: 192.168.1.3:21114</p>
<p>Please use RustDesk client to connect.</p>
</body>
</html>
';
        }

        # API代理
        location /api {
            proxy_pass http://rustdesk_server;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # 健康检查
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
}